---
title: 快速体验 Apache Doris
language: zh-CN
description: 自 Doris 2.1.8 版本后，可以使用 Docker 进行快速部署。
---

> ⚠️ **警告**
>
> 以下快速部署方法**仅用于本地开发和测试**，**请勿用于生产环境**。原因如下：
>
> 1. **数据易丢失：** Docker 部署在容器销毁时会丢失数据；手动部署单副本实例不具备数据冗余备份能力，机器宕机可能导致数据丢失。
> 2. **单副本配置：** 示例中的建表语句均为单副本，生产环境应使用多副本存储数据，以保证数据可靠性。

---

# 使用 Docker 快速部署

自 Doris 2.1.8 版本后，可以使用 Docker 进行快速部署。

## 第 1 步：下载 Quick-Start 脚本

下载脚本后，赋予执行权限：

```shell
chmod 755 start-doris.sh
```

## 第 2 步：启动集群

默认启动 4.0.1 版本：

```shell
bash start-doris.sh
```

指定版本启动：

```shell
bash start-doris.sh -v 2.1.8
```

## 第 3 步：检查集群状态

### 检查 FE 状态

```shell
mysql -uroot -P9030 -h127.0.0.1 -e 'SELECT `host`, `join`, `alive` FROM frontends()'
```

### 检查 BE 状态

```shell
mysql -uroot -P9030 -h127.0.0.1 -e 'SELECT `host`, `alive` FROM backends()'
```

---

# 本地快速部署

## 环境建议

- 操作系统：推荐 Ubuntu 等主流 Linux 环境
- Java 环境：建议使用 Java 17
- 用户权限：建议新建 doris 用户，避免使用 root

---

## 第 1 步：下载二进制包

从 Apache Doris 官方网站下载对应版本的二进制包并解压。

---

## 第 2 步：修改环境变量

### 修改最大文件句柄数

编辑：

```shell
vi /etc/security/limits.conf
```

添加：

```text
* soft nofile 1000000
* hard nofile 1000000
```

---

### 修改虚拟内存区域

```shell
cat >> /etc/sysctl.conf << EOF
vm.max_map_count = 2000000
EOF

sudo sysctl -p
```

---

## 第 3 步：安装 FE

### 修改 FE 配置

编辑：

```shell
apache-doris/fe/conf/fe.conf
```

修改：

```text
JAVA_HOME=/home/doris/jdk
priority_networks=127.0.0.1/32
```

### 启动 FE

```shell
apache-doris/fe/bin/start_fe.sh --daemon
```

### 检查 FE 状态

```shell
mysql -uroot -P9030 -h127.0.0.1 -e "show frontends;"
```

---

## 第 4 步：安装 BE

### 修改 BE 配置

编辑：

```shell
apache-doris/be/conf/be.conf
```

修改：

```text
JAVA_HOME=/home/doris/jdk
priority_networks=127.0.0.1/32
```

### 启动 BE

```shell
apache-doris/be/bin/start_be.sh --daemon
```

### 注册 BE 节点

```shell
mysql -uroot -P9030 -h127.0.0.1
```

```sql
ALTER SYSTEM ADD BACKEND "127.0.0.1:9050";
```

### 检查 BE 状态

```shell
mysql -uroot -P9030 -h127.0.0.1 -e "show backends;"
```

---

# 运行查询

## 连接数据库

```shell
mysql -uroot -P9030 -h127.0.0.1
```

---

## 创建数据库与测试表

> ⚠️ 本地单 BE 环境必须指定 `"replication_num" = "1"`

```sql
CREATE DATABASE demo;

USE demo;

CREATE TABLE mytable
(
    k1 TINYINT,
    k2 DECIMAL(10, 2) DEFAULT "10.05",
    k3 CHAR(10) COMMENT "string column",
    k4 INT NOT NULL DEFAULT "1" COMMENT "int column"
)
COMMENT "my first table"
DISTRIBUTED BY HASH(k1) BUCKETS 1
PROPERTIES (
    "replication_num" = "1"
);
```

---

## 插入测试数据

```sql
INSERT INTO mytable VALUES
(1,0.14,'a1',20),
(2,1.04,'b2',21),
(3,3.14,'c3',22),
(4,4.35,'d4',23);
```

---

## 查询数据

```sql
SELECT * FROM demo.mytable;
```

---

# 常见问题

## Q1: Mac 如何安装 Docker？

下载并安装 Docker Desktop。

---

## Q2: Docker 环境未检测到？

创建符号链接：

```shell
sudo ln -s /Applications/Docker.app/Contents/Resources/bin/docker /usr/local/bin/docker
```

---

## Q3: error getting credentials？

删除：

```shell
~/.docker/config.json
```

中的 `credsStore` 字段（仅限本地开发环境）。

---

## Q4: replication num 报错？

错误信息：

```
replication num should be less than the number of available backends
```

解决方案：

建表时必须显式指定：

```sql
PROPERTIES (
    "replication_num" = "1"
);
```

---

